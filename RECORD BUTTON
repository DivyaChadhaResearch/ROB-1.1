#include <Servo.h>
#include <EEPROM.h>

#define RECORD_BUTTON 2    // Push button for recording
#define SERVO_COUNT 6
#define MAX_STEPS 10

Servo servos[SERVO_COUNT];
int servoPins[SERVO_COUNT] = {3, 5, 6, 9, 10, 11};
int potPins[SERVO_COUNT]   = {A0, A1, A2, A3, A4, A5};

int stepCount = 0;

void setup() {
  pinMode(RECORD_BUTTON, INPUT_PULLUP);
  for (int i = 0; i < SERVO_COUNT; i++) {
    servos[i].attach(servoPins[i]);
    servos[i].write(90); // Start at center
  }
}

void loop() {
  // Move servos live with potentiometers
  for (int i = 0; i < SERVO_COUNT; i++) {
    int angle = map(analogRead(potPins[i]), 0, 1023, 0, 180);
    servos[i].write(angle);
  }

  // If Record button is pressed, save current angles
  if (digitalRead(RECORD_BUTTON) == LOW && stepCount < MAX_STEPS) {
    delay(300); // debounce
    for (int i = 0; i < SERVO_COUNT; i++) {
      int angle = map(analogRead(potPins[i]), 0, 1023, 0, 180);
      EEPROM.update(stepCount * SERVO_COUNT + i, angle);
    }
    stepCount++;
    EEPROM.update(MAX_STEPS * SERVO_COUNT, stepCount); // save total steps
  }
}
